<a href="<?php echo $this->url(array('module' => 'registro', 'controller' => 'titulodocumentos', 'action' => 'acompanhamento'), null, true); ?>" id="back-link">voltar</a>

<h1>Cadastro de Pedido </h1>

<div id="messenger"><?php echo $this->flashMessenger();?></div>

<?php echo $this->form;
		
echo $this->formP;
?>

<table cellspacing="1" cellpadding="1" border="1" class="display" id="tabela"  >
    <thead>
        <tr>
            <th>#</th>
            <th>Documento</th>
			<th>Nome</th>
            <th>Ação</th>
        </tr>
    </thead>
    <tbody>
<?php
	if(isset($_SESSION['pessoascitadas'])){
		$i = 1;
		foreach ($_SESSION['pessoascitadas'] as $pessoa) {
?> 
        <tr>
            <td align="center"><?php echo $i; ?></td>
            <td align="center"><?php echo $this->documento($pessoa['numeroidentificacao'], $pessoa['tipo_identificacao']);?></td>
			<td align="center"><?php echo $this->escape($pessoa['nome']); ?></td>
            <td align="center"><?php echo $this->escape($pessoa['notificar']); ?></td>
        </tr> 
<?php
			$i++;
		}
	}
?> 		
    </tbody>
				
</table>


<style>
input{
	text-transform: uppercase;
} 
</style>

<script type="text/javascript">


	$(function() {
		
		
		$('input').change(function(){
			var tipoemolumento = $("#tipoemolumento").val();
			var valor = $("#valordocumento").val();
			
			$.ajax({
	    		url:"<?php echo $this->url(array('module' => 'registro', 'controller' => 'titulodocumentos', 'action' => 'calculocusta'), null, true); ?>",
    			dataType:'json',
    			encoding: 'utf-8',
   				data:{id: tipoemolumento, valor: valor},
    			type:'GET',
    			success: function(data){						
					var valordocumento = parseInt(valor);
						
					if(data.tipo_custa == 0)
					{
						var totalcustas = 0
							
						if($('#numeropaginas').val() > data.pagina_inicial)
						{
							var qtpagina = $('#numeropaginas').val() - data.pagina_inicial;
							totalcustas = totalcustas + ($('#numerovias').val() * (qtpagina * data.pagina_extra));
							totalcustas = totalcustas + ($('#numerovias').val() * data.emolumento);
						}
						else{
							totalcustas = totalcustas + ($('#numerovias').val() * data.emolumento);
						}
						totalcustas = (totalcustas + (data.funcivil + data.taxa));
									
						$('#emolumento').val(data.emolumento);
						$('#emolumento').setMask('decimal');
						$('#total_custas').val(totalcustas);
						$('#total_custas').setMask('decimal');
						$('#taxajudiciaria').val(data.taxa);
						$('#taxajudiciaria').setMask('decimal');
						$('#funcivil').val(data.funcivil);
						$('#funcivil').setMask('decimal');
									
						totalcustasDec = ((totalcustas + (data.funcivil + data.taxa)) / 100);
						emolumentoDec = (data.emolumento / 100);
						taxajudiciariaDec = (data.taxa / 100);
						funcivilDec = (data.funcivil / 100);
					}
    			}
			});
		});
		
		
		
		$('#Pessoa-estado_citado').change(function() { 
		
	    	var id = $(this).val();		    	    			     

	    	$.ajax({
	    		url:"<?php echo $this->url(array('module' => 'registro', 'controller' => 'titulodocumentos', 'action' => 'getcidades'), null, true); ?>",
    			dataType:'html',
    			encoding: 'utf-8',
   				data:{id: id},
    			type:'GET',
    			success: function(data){
            				$('#Pessoa-cidade_citado').html(data);
    			}
			});
		});
		
		$('#Pessoa-documento_citado').change(function() { 
			
	    	var doc = $(this).val();
			var i = doc.replace(/[^0-9]/g, "");
	    		
	    	$.ajax({
	    		url:"<?php echo $this->url(array('module' => 'registro', 'controller' => 'titulodocumentos' , 'action' => 'getpessoa'), null, true); ?>",
    			dataType:'html',
    			//encoding: 'iso-8859-1',
   				data:{doc: doc},
    			type:'GET',
    			onFailure: function() {
                    	    alert("Falha na execução desta tarefa.");
                },
    			success: function(data){
                	$('#Pessoa-nome_citado').html(data);
                	$("#Pessoa-nome_citado").val($('#idnome'+i).val()) ;
                	$("#Pessoa-telefone_citado").val($('#idtelefone'+i).val());
					$("#Pessoa-cep_citado").val($('#idcep'+i).val());
                	$("#Pessoa-endereco_citado").val($('#idendereco'+i).val());
                	$("#Pessoa-complemento_citado").val($('#idcomplemento'+i).val());
                	$("#Pessoa-bairro_citado").val($('#idbairro'+i).val());
                	$("#Pessoa-numero_citado").val($('#idnumero'+i).val());
					$("#Pessoa-obs_citado").val($('#idobs'+i).val());
					var uf = $('#iduf'+i).val();
                	$("#Pessoa-estado_citado").val(uf);
        	    	$.ajax({
        	    		url:"<?php echo $this->url(array('module' => 'registro', 'controller' => 'titulodocumentos', 'action' => 'getcidades'), null, true); ?>",
            			dataType:'html',
            			encoding: 'utf-8',
           				data:{id: uf},
            			type:'GET',
            			success: function(data){
                    				$('#Pessoa-cidade_citado').html(data);
            					 }
        			});
    			}
			});
		});

	});
</script>